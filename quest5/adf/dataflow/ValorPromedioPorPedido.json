{
	"name": "ValorPromedioPorPedido",
	"properties": {
		"description": "Promedio del importe por pedido (orden) en un periodo: Ventas totales / número de pedidos",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DataSet_SQL_AdventureWorks",
						"type": "DatasetReference"
					},
					"name": "getData"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DataSet_Sink_DataLake",
						"type": "DatasetReference"
					},
					"name": "SaveData"
				}
			],
			"transformations": [],
			"scriptLines": [
				"source(output(",
				"          CustomerID as integer,",
				"          NameStyle as boolean,",
				"          Title as string,",
				"          FirstName as string,",
				"          MiddleName as string,",
				"          LastName as string,",
				"          Suffix as string,",
				"          CompanyName as string,",
				"          SalesPerson as string,",
				"          EmailAddress as string,",
				"          Phone as string,",
				"          PasswordHash as string,",
				"          PasswordSalt as string,",
				"          rowguid as string,",
				"          ModifiedDate as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: ';WITH MonthlyProductSales AS (\\n    SELECT \\n        DATEPART(YEAR, h.OrderDate) AS Año,\\n        DATEPART(MONTH, h.OrderDate) AS Mes,\\n        p.Name AS Producto,\\n        SUM(d.LineTotal) AS VentasProducto,\\n        RANK() OVER (\\n            PARTITION BY DATEPART(YEAR, h.OrderDate),\\n                         DATEPART(MONTH, h.OrderDate)\\n            ORDER BY SUM(d.LineTotal) DESC\\n        ) AS RankingMensual\\n    FROM SalesLT.SalesOrderHeader h\\n    JOIN SalesLT.SalesOrderDetail d \\n        ON h.SalesOrderID = d.SalesOrderID\\n    JOIN SalesLT.Product p\\n        ON d.ProductID = p.ProductID\\n    GROUP BY \\n        DATEPART(YEAR, h.OrderDate),\\n        DATEPART(MONTH, h.OrderDate),\\n        p.Name\\n)\\nSELECT *\\nFROM MonthlyProductSales\\nWHERE RankingMensual <= 5\\nORDER BY Año, Mes, RankingMensual;\\n',",
				"     format: 'query') ~> getData",
				"getData sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'parquet',",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SaveData"
			]
		}
	}
}