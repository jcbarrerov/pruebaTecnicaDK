{
	"name": "Top5ProductosMes",
	"properties": {
		"description": "Para cada mes, identificar los 5 productos con mayor monto vendido",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DataSet_SQL_AdventureWorks",
						"type": "DatasetReference"
					},
					"name": "getData",
					"description": "Import data from DataSet_SQL_AdventureWorks"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DataSet_Sink_DataLake",
						"type": "DatasetReference"
					},
					"name": "saveData"
				}
			],
			"transformations": [],
			"scriptLines": [
				"source(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'WITH MonthlyProductSales AS (\\n    SELECT \\n        DATEPART(YEAR, h.OrderDate) AS Año,\\n        DATEPART(MONTH, h.OrderDate) AS Mes,\\n        p.Name AS Producto,\\n        SUM(d.LineTotal) AS VentasProducto,\\n        RANK() OVER (\\n            PARTITION BY DATEPART(YEAR, h.OrderDate),\\n                         DATEPART(MONTH, h.OrderDate)\\n            ORDER BY SUM(d.LineTotal) DESC\\n        ) AS RankingMensual\\n    FROM SalesLT.SalesOrderHeader h\\n    JOIN SalesLT.SalesOrderDetail d \\n        ON h.SalesOrderID = d.SalesOrderID\\n    JOIN SalesLT.Product p\\n        ON d.ProductID = p.ProductID\\n    GROUP BY \\n        DATEPART(YEAR, h.OrderDate),\\n        DATEPART(MONTH, h.OrderDate),\\n        p.Name\\n)\\nSELECT *\\nFROM MonthlyProductSales\\nWHERE RankingMensual <= 5\\nORDER BY Año, Mes, RankingMensual',",
				"     format: 'query') ~> getData",
				"getData sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'parquet',",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> saveData"
			]
		}
	}
}